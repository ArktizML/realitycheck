{% extends "base.html" %}

{% block title %}Events | RealityCheck{% endblock %}

{% block content %}
    {% if notice %}
    <div class="login-popup">
        <div class="popup-box">
            {{ notice }}
            <a href="/" class="close-popup">Ã—</a>
        </div>
    </div>
    {% endif %}

    {% if overplanning %}
    <div class="overplanning-alert">
        You have {{ planned_count }} planned goals.
        Finish something before adding more.
    </div>
    {% endif %}

    <div class="events-header">
        <h2>You have {{ count }} plans ğŸ“†</h2>
        <a class="sort-toggle"
           title="Toggle sorting order" href="/?status={{ status or '' }}&sort={{ 'asc' if sort == 'desc' else 'desc' }}">
            {% if sort == "desc" %}
                Newest first â†“
            {% else %}
                Oldest first â†‘
            {% endif %}
        </a>

    </div>
    <div class="status-filters">
        <a href="/?status=planned&sort={{ sort }}"
           class="{{ 'active' if status == 'planned' else '' }}">Planned</a>

        <a href="/?status=done&sort={{ sort }}"
           class="{{ 'active' if status == 'done' else '' }}">Done</a>

        <a href="/?status=failed&sort={{ sort }}"
           class="{{ 'active' if status == 'failed' else '' }}">Failed</a>

        <a href="/?status=overdue&sort={{ sort }}"
           class="{{ 'active' if status == 'overdue' else '' }}">Overdue</a>

        <a href="/?sort={{ sort }}"
           class="{{ 'active' if not status else '' }}">All</a>
    </div>

{% if events %}
        <div class="container mt-4">
    <div class="row g-4">
        <div class="events-grid">
            {% for event in events %}
            <div class="card event-card {{ event.status.value }} {% if event.due_date and event.due_date < today and event.status == 'planned' %}
            overdue
            {% endif %}">

                <div class="event-card-header">
                    <h3>{{ event.title }}</h3>
                    <span class="status-badge {{ event.status.value }}">
                        {{ event.status.value|upper }}
                    </span>
                </div>
                {% if event.tags %}
                <div class="event-tags">
                    {% for tag in event.tags %}
                        <span class="tag-pill">{{ tag.name }}</span>
                    {% endfor %}
                </div>
                {% endif %}

                <div class="event-card-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ event.progress }}%"></div>
                    </div>
                    <span class="progress-text">{{ event.progress }}%</span>
                </div>

                <p class="event-desc">
                    {{ event.description or "No description yet." }}
                </p>

                {% if event.due_date %}
                <div class="event-deadline">
                    Due: {{ event.due_date }}
                </div><br>
                {% endif %}

                <div class="event-card-actions">
                    <a href="/events/{{ event.id }}" class="btn view">ğŸ” View</a>
                    <a href="/events/{{ event.id }}/edit" class="btn edit">âœï¸ Edit</a>
                </div>

            </div>
            {% endfor %}

            <div class="card event-card add-card" onclick="location.href='/events/new'">
                <div class="add-inner">
                    <div class="add-plus">+</div>
                    <div class="add-text">Add new plan</div>
                </div>
            </div>


        </div>
    </div>
</div>
{% else %}
    <div class="container mt-4">
        <div class="row g-4">
            <div class="card event-card add-card" onclick="location.href='/events/new'">
                <div class="add-inner">
                    <div class="add-plus">+</div>
                    <div class="add-text">Add new plan</div>
                </div>
            </div>
        </div>
    </div>
{% endif %}
{% endblock %}